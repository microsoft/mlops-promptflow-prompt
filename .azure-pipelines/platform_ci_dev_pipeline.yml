
parameters:
 - name: exec_environment
   displayName: "Execution Environment"
   default: "dev"
 - name: model_type
   displayName: "type of model to execute"

stages:
  - stage: execute_prompt_evaluation
    displayName: Evaluation Flow
    jobs:
    - job: Execute_pf_Pipeline
      displayName: 'Execute Evaluation'
      steps:
      - template: templates/configure_devops_agent.yml

      - script: |
            python -m flows.${{ parameters.model_type }}.evaluate.evaluate \
              --environment_name ${{ parameters.exec_environment }}
        displayName: 'Run Evaluation'

  - stage: deploy_prompts
    displayName: Deploy Online Endpoint
    dependsOn: 
    - execute_prompt_evaluation
    jobs:
    - job: deploy_flow
      steps:
      - template: templates/configure_devops_agent.yml
