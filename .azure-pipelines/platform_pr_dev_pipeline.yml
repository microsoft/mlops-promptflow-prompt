
parameters:
 - name: exec_environment
   displayName: "Execution Environment"
   default: "pr"
 - name: model_type
   displayName: "type of model to execute"


stages:
  - stage: build_validation
    displayName: build_validation
    jobs:
      - template: build_validation_pipeline.yml
  - stage: execute_training_job
    displayName: execute_training_job
    dependsOn: 
    - build_validation
    jobs:
    - job: Execute_ml_Job_Pipeline
      steps:
      - template: templates/get_connection_details.yml
      - template: templates/configure_azureml_agent.yml
      - template: templates/execute_mlops_pipeline.yml
        parameters:
          script_parameter: |
            python -m mlops.azure_prompt_pipeline \
              --config_name ${{ parameters.model_type }} \
              --environment_name ${{ parameters.exec_environment }} \
              --subscription_id $(SUBSCRIPTION_ID) \
              --output_file run_id.txt
